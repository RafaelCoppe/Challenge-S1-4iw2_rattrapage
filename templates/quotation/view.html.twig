{% extends 'base.html.twig' %}

{% block title %}Détails du devis {{ quotation.id }}{% endblock %}

{% block body %}
    <h1>Détails du devis {{ quotation.id }}</h1>

    <a href="{{ path('quotation_index') }}" class="btn btn-primary">Retour à la liste</a>

    <ul>
        <li>ID: {{ quotation.id }}</li>
        <li>Invoice ID: {{ quotation.invoice_id is defined ? quotation.invoice_id : '' }}</li>
        <li>Agency ID: {{ quotation.agency.name }}</li>
        <li>Client ID: {{ quotation.client.lastname }}</li>
        <li>Terms: {{ quotation.terms is defined ? quotation.terms : '' }}</li>
        <li>Status: {{ quotation.status }}</li>
        <li>Start Date: {{ quotation.startDate|date('Y-m-d H:i:s') }}</li>
        <li>End Date: {{ quotation.endDate|date('Y-m-d H:i:s') }}</li>
        <li>Duration: {{ quotation.duration }}</li>
        <li>Ref: {{ quotation.ref }}</li>
    </ul>
    <br>
    {% for line in lines %}
        <h2>Ligne {{line.place}}</h2>
        <ul>
            <li>Ligne ID: {{ line.id }}</li>
            <li>Product: {{ line.product.label }} {{ line.product.type }}</li>
            <li>Unit Price: {{ line.UnitPrice }}</li>
            <li>Quantity: {{ line.quantity }}</li>
            <li>Additional: {{ line.additional }}</li>
            <li>Tax: {{ line.tax }}</li>
        </ul>
        <br>
        {% if quotation.status != 'Terminé'%}
        <a href="{{ path('line_edit', {'quotation_id': quotation.id, 'line_id': line.id}) }}">Editer la ligne</a>

        <form action="{{ path('line_delete', {'quotation_id': quotation.id, 'line_id': line.id}) }}" method="post">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ line.id) }}">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette ligne ?')">Supprimer la ligne</button>
        </form>
        <br>
        {% endif %}
    {% endfor %}

    {% if quotation.status == 'Brouillon' or quotation.status == 'En Cours' %}
        <a href="{{ path('line_create', {'quotation_id': quotation.id}) }}" class="btn btn-primary">Ajouter une ligne</a>
        <br>
        <a href="{{ path('quotation_edit', {'id': quotation.id}) }}" class="btn btn-primary">Éditer</a>

        <form action="{{ path('quotation_delete', {'id': quotation.id}) }}" method="post">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ quotation.id) }}">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce devis ?')">Supprimer</button>
        </form>
    {% endif %}

    {% if quotation.status != 'Terminé' %}
        <a href="{{ path('app_pdf', {'id': quotation.id, "facture":0}) }}" class="btn btn-primary download-pdf-btn" data-status="{{ quotation.status }}">Télécharger le devis</a>
    {% endif %}

    {% if quotation.status == 'En Cours' %}
        <form action="{{ path('quotation_validate', {'id': quotation.id}) }}" method="post">
            <input type="hidden" name="_token" value="{{ csrf_token('validate' ~ quotation.id) }}">
            <button type="submit" class="btn btn-info">Valider le devis</button>
        </form>
    {% endif %}
    {% if quotation.status == 'Validé' %}
        <form action="{{ path('quotation_inProgress', {'id': quotation.id}) }}" method="post">
            <input type="hidden" name="_token" value="{{ csrf_token('validate' ~ quotation.id) }}">
            <button type="submit" class="btn btn-info">Passer à En Cours</button>
        </form>
        <a href="{{ path('app_pdf', {'id': quotation.id, "facture":1}) }}" class="btn btn-primary download-pdf-btn" data-status="{{ quotation.status }}">Télécharger la Facture</a>
    {% endif %}
    <br>
{% endblock %}
